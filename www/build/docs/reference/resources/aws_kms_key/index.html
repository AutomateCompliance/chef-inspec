<!DOCTYPE html><html><head><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><meta charset="utf-8" /><meta content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport" /><link href="/favicon.png" rel="icon" type="image/png" /><link href="/favicon.ico" rel="icon" /><title>About the aws_kms_key Resource</title><meta name="description" /><link href="/css/inspec_tutorial.css" rel="stylesheet" type="text/css" /><link href="/stylesheets/vendor/fontawesome.min.css" rel="stylesheet" type="text/css" /><link href="/stylesheets/site.css" rel="stylesheet" /></head><body class="docs docs_reference docs_reference_resources docs_reference_resources_aws_kms_key docs_reference_resources_aws_kms_key_index"><script>gm_session_id = 'inspecGlobalMessage8';</script><div class="container"><nav class="shadow" id="main-nav"><progress value="0"></progress><div id="main-nav-ctas"><a class="main-nav--logo" href="/"><img alt="logo for Chef InSpec" onerror="this.src='/images/chef-inspec.png'" src="/images/chef-inspec.svg" /></a><i class="fa fa-bars main-nav--toggle strict-right mobile-show"></i><ul class="main-nav--links"><li class="main-nav--link"><a href="/tutorials" class="link " <span class="main-nav--link-text">Tutorials</span></a></li><li class="main-nav--link"><a href="/docs" class="link " <span class="main-nav--link-text">Docs</span></a></li><li class="main-nav--link"><a href="/community" class="link " <span class="main-nav--link-text">Community</span></a></li><li class="main-nav--link"><a class="link" href="https://github.com/chef/inspec"><i class="fa fa-github"></i><span class="main-nav--link-text">Github</span></a></li><li class="nav-cta"><a class="button btn-sm btn-purple" href="/docs/reference/install"><i class="fa fa-cloud-download"></i>Download</a></li></ul></div></nav><main id="main-content"><!--header search--><header class="bg-gradient margin-top-offset relative"><div class="row"><div class="columns large-12 medium-12 z-20"><div class="flex align margin-both"><form action="/docs/search/" class="main-sidebar--search shadow-dark" method="get"><input class="st-default-search-input" name="q" placeholder="Search documentation..." type="search" /></form></div></div></div><div id="particles-second"><canvas class="particles-js-canvas-el" /></div></header><div class="row margin-both relative"><column class="columns large-3 medium-3 mobile-hide" id="sidebar"><ul class="main-sidebar--links"><li class="main-sidebar--link"><small>Getting Started</small><ul class="main-sidebar--list no-bullet"><li class="main-sidebar--list--item--a"><a href="/docs">Overview</a><i class="fa fa-angle-double-right focus strict-right"></i></li><li class="main-sidebar--list--item--a"><a href="/docs/reference/install">Install and Uninstall</a><i class="fa fa-angle-double-right focus strict-right"></i></li><li class="main-sidebar--list--item--a"><a href="/docs/reference/platforms">Chef InSpec for the cloud</a><i class="fa fa-angle-double-right focus strict-right"></i></li><li class="main-sidebar--list--item--a"><a href="/tutorials">Tutorials</a><i class="fa fa-angle-double-right focus strict-right"></i></li><li class="main-sidebar--list--item--a"><a href="/docs/reference/inspec_and_friends">Chef InSpec and friends</a><i class="fa fa-angle-double-right focus strict-right"></i></li><li class="main-sidebar--list--item--a"><a href="/docs/reference/glossary">Chef InSpec Glossary</a><i class="fa fa-angle-double-right focus strict-right"></i></li></ul></li><li class="main-sidebar--link"><small>Reference</small><ul class="main-sidebar--list no-bullet"><li class="main-sidebar--list--item--a"><a href="/docs/reference/cli">inspec executable</a><i class="fa fa-angle-double-right focus strict-right"></i></li><li class="main-sidebar--list--item--a"><a href="/docs/reference/profiles">Profiles</a><i class="fa fa-angle-double-right focus strict-right"></i></li><li class="main-sidebar--list--item--a"><a href="/docs/reference/resources">Resources</a><i class="fa fa-angle-double-right focus strict-right"></i></li><li class="main-sidebar--list--item--a"><a href="/docs/reference/inputs">Inputs</a><i class="fa fa-angle-double-right focus strict-right"></i></li><li class="main-sidebar--list--item--a"><a href="/docs/reference/matchers">Matchers</a><i class="fa fa-angle-double-right focus strict-right"></i></li><li class="main-sidebar--list--item--a"><a href="/docs/reference/reporters">Reporters</a><i class="fa fa-angle-double-right focus strict-right"></i></li><li class="main-sidebar--list--item--a"><a href="/docs/reference/config">Configuration</a><i class="fa fa-angle-double-right focus strict-right"></i></li><li class="main-sidebar--list--item--a"><a href="/docs/reference/dsl_inspec">Chef InSpec DSL</a><i class="fa fa-angle-double-right focus strict-right"></i></li><li class="main-sidebar--list--item--a"><a href="/docs/reference/style">Profile Style guide</a><i class="fa fa-angle-double-right focus strict-right"></i></li><li class="main-sidebar--list--item--a"><a href="/docs/reference/dsl_resource">Custom Resources</a><i class="fa fa-angle-double-right focus strict-right"></i></li><li class="main-sidebar--list--item--a"><a href="/docs/reference/plugins">Plugins</a><i class="fa fa-angle-double-right focus strict-right"></i></li><li class="main-sidebar--list--item--a"><a href="/docs/reference/plugin_kitchen_inspec">kitchen-inspec</a><i class="fa fa-angle-double-right focus strict-right"></i></li><li class="main-sidebar--list--item--a"><a href="/docs/reference/shell">inspec shell</a><i class="fa fa-angle-double-right focus strict-right"></i></li><li class="main-sidebar--list--item--a"><a href="/docs/reference/habitat">Chef Habitat Integration</a><i class="fa fa-angle-double-right focus strict-right"></i></li><li class="main-sidebar--list--item--a"><a href="/docs/reference/migration">Migration from Serverspec</a><i class="fa fa-angle-double-right focus strict-right"></i></li><li class="main-sidebar--list--item--a"><a href="/docs/reference/waivers">Waivers</a><i class="fa fa-angle-double-right focus strict-right"></i></li></ul></li></ul></column><column class="columns large-9 medium-9 mobile-12" id="mainbar"><h1 id="aws_kms_key">aws_kms_key</h1>

<p>Use the <code>aws_kms_key</code> InSpec audit resource to test properties of a single AWS KMS Key.</p>

<p>AWS Key Management Service (AWS KMS) is a managed service that makes it easy for you to create and control the encryption keys used to encrypt your data. AWS KMS lets you create master keys that can never be exported from the service and which can be used to encrypt and decrypt data based on policies you define.</p>

<p>Each AWS KMS Key is uniquely identified by its key_id or arn.</p>

<h2 id="syntax">Syntax</h2>

<p>An aws_kms_key resource block identifies a key by key_arn or the key id.</p>
<div class="highlight"><pre class="highlight plaintext"><code># Find a kms key by arn
describe aws_kms_key('arn:aws:kms:us-east-1::key/4321dcba-21io-23de-85he-ab0987654321') do
  it { should exist }
end

# Find a kms key by just the id
describe aws_kms_key('4321dcba-21io-23de-85he-ab0987654321') do
  it { should exist }
end

# Hash syntax for key arn
describe aws_kms_key(key_id: 'arn:aws:kms:us-east-1::key/4321dcba-21io-23de-85he-ab0987654321') do
  it { should exist }
end
</code></pre></div>
<h4 id="parameters">Parameters</h4>

<h5 id="alias-required-if-keyid-not-specified-_">alias <em>(required if `key</em>id` not specified)_</h5>

<p>This resource accepts searching for a KMS Key by it&rsquo;s Alias.
This can be passed as a <code>alias: &#39;alias/value&#39;</code> key-value entry in a hash. This will then use the <code>target_key_id</code> from the Alias to search for the KMS Key.</p>

<h5 id="key_id-required-if-alias-not-specified">key_id <em>(required if <code>alias</code> not specified)</em></h5>

<p>This resource accepts searching for a KMS Key by the KMS Key ID which can represent both the actual Key ID or the ARN of the Key.
This can be passed either as a string or as a <code>key_id: &#39;value&#39;</code> key-value entry in a hash.</p>

<p>See also the <a href="https://docs.aws.amazon.com/kms/latest/developerguide/getting-started.html">AWS documentation on KS Keys</a>.</p>

<h2 id="properties">Properties</h2>

<table><thead>
<tr>
<th>Property</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>key_id</td>
<td>The globally unique identifier for the key.</td>
</tr>
<tr>
<td>arn</td>
<td>The ARN identifier of the specified key.</td>
</tr>
<tr>
<td>creation_date</td>
<td>Specifies the date and time when the key was created.</td>
</tr>
<tr>
<td>created_days_ago</td>
<td>Specifies the number of days since the key was created.</td>
</tr>
<tr>
<td>key_state</td>
<td>Specifies the state of the key one of &ldquo;Enabled&rdquo;, &ldquo;Disabled&rdquo;, &ldquo;PendingDeletion&rdquo;, &ldquo;PendingImport&rdquo;. To just check if the key is enabled or not, use the <code>be_enabled</code> matcher.</td>
</tr>
<tr>
<td>description</td>
<td>The description of the key.</td>
</tr>
<tr>
<td>deletion_time</td>
<td>Specifies the date and time after which AWS KMS deletes the key. This value is present only when KeyState is PendingDeletion, otherwise this value is nil.</td>
</tr>
<tr>
<td>invalidation_time</td>
<td>Provides the date and time until the key is not valid.  Once the key is not valid, AWS KMS deletes the key and it becomes unusable.  This value will be null unless the keys Origin is EXTERNAL and its matcher have_key_expiration is set to true.</td>
</tr>
</tbody></table>

<h2 id="examples">Examples</h2>

<h5 id="test-that-the-specified-key-does-exist">Test that the specified key does exist</h5>
<div class="highlight"><pre class="highlight plaintext"><code>describe aws_kms_key('arn:aws:kms:us-east-1::key/4321dcba-21io-23de-85he-ab0987654321') do
  it { should exist }
end
</code></pre></div>
<h5 id="test-that-the-specified-key-is-enabled">Test that the specified key is enabled</h5>
<div class="highlight"><pre class="highlight plaintext"><code>describe aws_kms_key('arn:aws:kms:us-east-1::key/4321dcba-21io-23de-85he-ab0987654321') do
  it { should be_enabled }
end
</code></pre></div>
<h5 id="test-that-the-specified-key-is-rotation-enabled">Test that the specified key is rotation enabled</h5>
<div class="highlight"><pre class="highlight plaintext"><code>describe aws_kms_key('arn:aws:kms:us-east-1::key/4321dcba-21io-23de-85he-ab0987654321') do
  it { should have_rotation_enabled }
end
</code></pre></div>
<h5 id="makes-sure-that-the-key-was-created-at-least-10-days-ago">Makes sure that the key was created at least 10 days ago</h5>
<div class="highlight"><pre class="highlight plaintext"><code>describe aws_kms_key('arn:aws:kms:us-east-1::key/4321dcba-21io-23de-85he-ab0987654321') do
  its('creation_date') { should be &lt; Time.now - 10 * 86400 }
end
</code></pre></div>
<h2 id="matchers">Matchers</h2>

<p>This InSpec audit resource has the following special matchers. For a full list of available matchers (such as <code>exist</code>) please visit our <a href="https://www.inspec.io/docs/reference/matchers/">matchers page</a>.</p>

<p>Use <code>should_not</code> to test the entity should not exist in all cases.</p>

<h4 id="exist">exist</h4>

<p>The control will pass if the describe returns at least one result.</p>
<div class="highlight"><pre class="highlight plaintext"><code>  it { should exist }

  it { should_not exist }
</code></pre></div>
<h4 id="be_enabled">be_enabled</h4>

<p>The test will pass if the specified key&rsquo;s key_state is set to enabled.</p>
<div class="highlight"><pre class="highlight plaintext"><code>  it { should be_enabled }
</code></pre></div>
<h4 id="be_external">be_external</h4>

<p>Provides whether the source of the key&rsquo;s key material is external or not.  If it is not external than it was created by AWS KMS.  When it is external, the key material was imported from an existing key management infrastructure or the key lacks key material.</p>
<div class="highlight"><pre class="highlight plaintext"><code>  it { should be_external }
</code></pre></div>
<h4 id="be_managed_by_aws">be_managed_by_aws</h4>

<p>Provides whether or not the key manager is from AWS. If it is not managed by AWS, it is managed by the customer.</p>
<div class="highlight"><pre class="highlight plaintext"><code>  it { should be_managed_by_aws }
</code></pre></div>
<h4 id="have_key_expiration">have_key_expiration</h4>

<p>Specifies whether the key&rsquo;s key material expires. This value is null unless the keys Origin is External.</p>
<div class="highlight"><pre class="highlight plaintext"><code>  it { should have_key_expiration }
</code></pre></div>
<h4 id="have_rotation_enabled">have_rotation_enabled</h4>

<p>The test will pass if automatic rotation of the key material is enabled for the specified key.</p>
<div class="highlight"><pre class="highlight plaintext"><code>  it { should have_rotation_enabled }
</code></pre></div>
<h2 id="aws-permissions">AWS Permissions</h2>

<p>Your <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/intro-structure.html#intro-structure-principal">Principal</a> will need the <code>kms:DescribeKey</code>, and <code>kms:GetKeyRotationStatus</code> actions set to allow.</p>

<p>You can find detailed documentation at <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/list_awskeymanagementservice.html">Actions, Resources, and Condition Keys for AWS Key Management Service</a>.</p>
</column><div class="scrollToTop shadow-dark"><img id="scrollup" onerror="this.src='/images/home/arrow.png'" src="/images/home/arrow.svg" /></div></div><script>// Swiftype JS code snippet
(function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
(w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
})(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

_st('install','xzyJV6P7pgscygGyyTm8','2.0.0');
// end Swiftype code snippet

document.getElementsByClassName("st-default-search-input")[0].focus();</script></main></div><footer class="dark-bg" id="main-footer"><div class="strict-center" id="dlmsg"><div class="pad-under-xs"><img alt="image of octagon spinning" id="hex" onerror="this.src='/images/octagon.png'" src="/images/octagon.svg" /></div><h3 class="t-white pad-under-xs">Get started with Chef InSpec and rock on.</h3><div class="row align columns"><div class="strict-center"><a class="button btn-lg btn-purple shadow-dark margin-right-xs mobile-row-btn" href="/downloads"><i class="fa fa-cloud-download"></i><span>download InSpec 4</span></a><a class="button btn-lg btn-white-o shadow-dark mobile-row-btn" href="/tutorials">browse tutorials</a></div></div></div><div class="flex align"><div class="columns large-4 medium-4 mobile-hide"><ul class="footer--logos"><li><a class="footer--logo inspec" href="/"><img alt="logo for Chef InSpec" src="/images/chef-inspec.png" /></a></li><li><a class="footer--logo chef" href="https://www.chef.io"><img alt="logo for Chef Software" src="/images/chef-logo.png" /></a></li></ul></div><div class="columns large-8 medium-8"><ul class="footer--links strict-right"><li><a class="link footer--link" href="https://docs.chef.io/chef_license.html">Licensing</a></li><li><a class="link footer--link" href="https://www.chef.io/terms-of-service/">Terms &amp; Conditions</a></li><li><a class="link footer--link" href="https://www.chef.io/trademark-policy/">Trademark Policy</a></li><li><a class="link footer--link" href="https://www.chef.io/privacy-policy/">Privacy Policy</a></li><li><a class="link footer--link" href="https://www.chef.io/cookie-policy/">Cookie Policy</a></li></ul><div class="columns margin-both-xs mobile-show"><ul class="footer--logos"><li><a class="footer--logo inspec" href="/"><img alt="logo for Chef InSpec" src="/images/chef-inspec.png" /></a></li><li><a class="footer--logo chef" href="http://www.chef.io"><img alt="logo for Chef Software" src="/images/chef-logo.png" /></a></li></ul></div></div></div><p class="strict-center pad-under-xs"><small class="t-gray">&copy; Chef Software 2015-2020</small></p></footer><script src="https://buttons.github.io/buttons.js"></script><script src="/scripts/inspec_tutorial.js"></script><script src="/dist/inspec_tutorial.js"></script><script src="/javascripts/vendor/jquery.min.js"></script><script src="https://s3.amazonaws.com/menumaker/menumaker.min.js"></script><div class="inspec-tutorial" hidden="true" inspec-tutorial="true">Loading</div><script src="/javascripts/all.js"></script><script>function initSlideGroup(group) {
  var prev = -1;
  var links = $(group).find('a')

  links.click(function(e) {
    e.stopPropagation()

    links.removeClass('selected')
    $(this).addClass('selected')

    var idx = $(this).index();
    if(prev == idx) return;
    prev = idx;

    $('.slider .view.slide-in').removeClass('slide-in').addClass('slide-out')
    var el = $('.slider .view')[idx]
    if(el == null) {
      console.log("No element for slider index "+idx)
      return
    }

    $(el).removeClass('slide-out').removeClass('hidden').addClass('slide-in')
  })

  if(links[0] != null) links[0].click();
}

function initSliders() {
  $('.slider .view').addClass('hidden')
  var groups = $('.slider .selectors')
  groups.each(function(idx){
    initSlideGroup(this)
  })
}

//run code colors

$(document).ready(function() {
  initSliders()
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});

//copy to clipboard

function copyToClipboard(element) {
  var $temp = $("<input>");
  $("body").append($temp);
  $temp.val($(element).text()).select();
  document.execCommand("copy");
  $temp.remove();
}

$('#copy').hover(function() {
   $('#install').toggleClass("text-focus");
});

$('#copy').click(function() {
   $(this).removeClass("fa-copy");
   $(this).addClass("fa-check");

 setTimeout(() => {
   $(this).removeClass('fa-check').addClass('fa-copy');
  }, 1500);
});

// homepage content slider

// tutorial content slider

$(function() {
  $(".collapseContent").hide();
  $(".collapsebtn").addClass("fa-plus-square");

   $('.collapseToggle').click(function() {
      var el = $(this).parent().find('.collapseContent')
      el.slideToggle("fast")
      // $('.collapseContent').slideToggle("fast");
      var btn = $(this).find('.collapsebtn')
      if(btn.hasClass('fa-minus-square')) {
        btn.addClass('fa-plus-square')
        btn.removeClass('fa-minus-square')
      } else {
        btn.addClass('fa-minus-square')
        btn.removeClass('fa-plus-square')
      }
   });
});



// scroll spy animations

var $slide_left = $('.slide-left');
var $slide_right = $('.slide-right');
var $slide_up = $('.slide-up');
var $slide_up_slow = $('.slide-up-slow');
var $window = $(window);

function check_if_in_view() {
  var window_height = $window.height();
  var window_top_position = $window.scrollTop();
  var window_bottom_position = (window_top_position + window_height);

  $.each($slide_left, function() {
    var $element = $(this);
    var element_height = $element.outerHeight();
    var element_top_position = $element.offset().top;
    var element_bottom_position = (element_top_position + element_height);

    //check to see if this current container is within viewport
    if ((element_bottom_position >= window_top_position) &&
        (element_top_position <= window_bottom_position)) {
      $element.addClass('in-view');
    } else {
      $element.removeClass('in-view');
    }
  });

  $.each($slide_right, function() {
    var $element = $(this);
    var element_height = $element.outerHeight();
    var element_top_position = $element.offset().top;
    var element_bottom_position = (element_top_position + element_height);

    //check to see if this current container is within viewport
    if ((element_bottom_position >= window_top_position) &&
        (element_top_position <= window_bottom_position)) {
      $element.addClass('in-view');
    } else {
      $element.removeClass('in-view');
    }
  });

  $.each($slide_up, function() {
    var $element = $(this);
    var element_height = $element.outerHeight();
    var element_top_position = $element.offset().top;
    var element_bottom_position = (element_top_position + element_height);

    //check to see if this current container is within viewport
    if ((element_bottom_position >= window_top_position) &&
        (element_top_position <= window_bottom_position)) {
      $element.addClass('in-view');
    } else {
      $element.removeClass('in-view');
    }
  });

  $.each($slide_up_slow, function() {
    var $element = $(this);
    var element_height = $element.outerHeight();
    var element_top_position = $element.offset().top;
    var element_bottom_position = (element_top_position + element_height);

    //check to see if this current container is within viewport
    if ((element_bottom_position >= window_top_position) &&
        (element_top_position <= window_bottom_position)) {
      $element.addClass('in-view');
    } else {
      $element.removeClass('in-view');
    }
  });
}

$window.on('scroll resize', check_if_in_view);
$window.trigger('scroll');

//scroll to top
$(document).ready(function(){

  $(window).scroll(function(){
    if ($(this).scrollTop() > 100) {
      $('.scrollToTop').fadeIn();
    } else {
      $('.scrollToTop').fadeOut();
    }
  });

  $('.scrollToTop').click(function(){
    $('html, body').animate({scrollTop : 0},800);
    return false;
  });

  // scrolling to resource sections
  $(".resources-button").click(function() {
    var dst = $(this).attr("href")
    $(".resources-button").removeClass("btn-purple").addClass("btn-purple-o")
    $(this).addClass("btn-purple").removeClass("btn-purple-o")
    $("html, body").animate({
        scrollTop: $(dst).offset().top - 105
    }, 1000);
  });

});

//scrolling code box

var div = $('#scrolled');
   setInterval(function(){
    var pos = div.scrollTop();
    div.scrollTop(pos + 2);
}, 200);

//Animating progress bar for header

$(document).ready(function(){

var getMax = function(){
    return $(document).height() - $(window).height();
}

var getValue = function(){
    return $(window).scrollTop();
}

if('max' in document.createElement('progress')){
    // Browser supports progress element
    var progressBar = $('progress');

    // Set the Max attr for the first time
    progressBar.attr({ max: getMax() });

    $(document).on('scroll', function(){
        // On scroll only Value attr needs to be calculated
        progressBar.attr({ value: getValue() });
    });

    $(window).resize(function(){
        // On resize, both Max/Value attr needs to be calculated
        progressBar.attr({ max: getMax(), value: getValue() });
    });
}
else {
    var progressBar = $('.progress-bar'),
        max = getMax(),
        value, width;

    var getWidth = function(){
        // Calculate width in percentage
        value = getValue();
        width = (value/max) * 100;
        width = width + '%';
        return width;
    }

    var setWidth = function(){
        progressBar.css({ width: getWidth() });
    }

    $(document).on('scroll', setWidth);
    $(window).on('resize', function(){
        // Need to reset the Max attr
        max = getMax();
        setWidth();
    });
    }
  });</script><script>$(document).foundation();
$('.try-demo').click(function(event){
  event.stopPropagation();
  $('.inspec-tutorial').show()
  window.dispatchEvent(new Event('resizeTerminal'));
  $('.quit-inspec-tutorial').click(function(event){
    event.stopPropagation();
    $('.inspec-tutorial').hide()
  })
});</script><script src="/javascripts/segment.js"></script></body></html>